<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>CRB ‚Äî Current Account Opening (5-step Wizard)</title>
    <style>
        :root {
            --primary: #236bbd;
            --primary-dark: #174f85;
            --bg: #f5f7fb;
            --border: #d8dee6;
        }

        * {
            box-sizing: border-box
        }

        body {
            font-family: "Segoe UI", Arial, sans-serif;
            background: var(--bg);
            margin: 0;
            color: #222;
            padding: 24px
        }

        .card {
            max-width: 1100px;
            margin: 18px auto;
            background: #fff;
            padding: 22px;
            border-radius: 12px;
            box-shadow: 0 12px 30px rgba(0, 0, 0, .06)
        }

        h1 {
            margin: 0 0 14px;
            color: var(--primary);
            text-align: center
        }

        /* Top tabs (bold tab style) */
        .tabs {
            display: flex;
            gap: 8px;
            justify-content: center;
            margin: 18px 0;
            flex-wrap: wrap
        }

        .tab {
            padding: 10px 14px;
            border-radius: 8px;
            border: 1px solid var(--border);
            background: #fff;
            font-weight: 700;
            color: #444;
            cursor: pointer;
            min-width: 150px;
            text-align: center;
        }

        .tab.active {
            background: linear-gradient(90deg, var(--primary), var(--primary-dark));
            color: #fff;
            border-color: transparent;
            box-shadow: 0 6px 18px rgba(35, 107, 189, .12)
        }

        .tab.completed {
            background: #f6fbff;
            color: var(--primary);
            border-color: #dfeeff
        }

        .steps {
            padding: 8px;
            min-height: 520px
        }

        fieldset {
            border: 1px solid var(--border);
            padding: 14px;
            border-radius: 8px;
            margin-bottom: 14px
        }

        legend {
            font-weight: 700;
            color: var(--primary)
        }

        label {
            display: block;
            margin-top: 10px;
            font-weight: 600;
            font-size: 13px;
            color: #333
        }

        input,
        select,
        textarea {
            width: 100%;
            padding: 10px 12px;
            margin-top: 6px;
            border-radius: 6px;
            border: 1px solid var(--border);
            background: #fafafa;
            font-size: 14px
        }

        .row {
            display: flex;
            gap: 12px
        }

        .row>div {
            flex: 1
        }

        .file-box {
            margin-top: 8px;
            padding: 12px;
            border: 2px dashed var(--border);
            border-radius: 8px;
            text-align: center;
            background: #fafafa;
            cursor: pointer
        }

        .file-box input[type=file] {
            display: none
        }

        .file-name {
            font-size: 13px;
            color: var(--primary);
            margin-top: 8px;
            word-break: break-all
        }

        .file-error {
            color: #d9534f;
            font-size: 12px;
            margin-top: 6px
        }

        .controls {
            display: flex;
            justify-content: space-between;
            gap: 12px;
            margin-top: 12px
        }

        .btn {
            background: var(--primary);
            color: #fff;
            padding: 10px 14px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: 700
        }

        .btn.secondary {
            background: #666
        }

        .muted {
            font-size: 13px;
            color: #666;
            margin-top: 8px;
            text-align: center
        }

        .review-box {
            background: #fbfdff;
            border: 1px solid #e6f0ff;
            padding: 10px;
            border-radius: 8px
        }

        .toast {
            position: fixed;
            right: 20px;
            bottom: 20px;
            background: #0f5132;
            color: #d1f8e6;
            padding: 12px 16px;
            border-radius: 8px;
            display: none
        }

        @media(max-width:800px) {
            .row {
                flex-direction: column
            }

            .tab {
                min-width: 120px
            }
        }

        .required {
            color: #d9534f;
            margin-left: 6px
        }
    </style>
    <!-- jsPDF (optional, used for quick PDF generation if you want) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>

<body>
    <div class="card">
        <h1>CRB ‚Äî Current Account Opening</h1>

        <div class="tabs" id="tabs"></div>

        <form id="wizardForm" novalidate>
            <div class="steps">

                <!-- STEP 1: PERSONAL -->
                <div class="step" data-step="0">
                    <fieldset>
                        <legend>1. Personal Information</legend>
                        <div class="row">
                            <div>
                                <label for="fullName">Full Name <span class="required">*</span></label>
                                <input id="fullName" name="fullName" required />
                            </div>
                            <div>
                                <label for="fatherName">Father / Spouse Name <span class="required">*</span></label>
                                <input id="fatherName" name="fatherName" required />
                            </div>
                        </div>

                        <div class="row">
                            <div>
                                <label for="dob">Date of Birth <span class="required">*</span></label>
                                <input id="dob" name="dob" type="date" required />
                            </div>
                            <div>
                                <label for="personalPan">Personal PAN <span class="required">*</span></label>
                                <input id="personalPan" name="personalPan" placeholder="ABCDE1234F"
                                    pattern="[A-Z]{5}[0-9]{4}[A-Z]{1}" required />
                            </div>
                        </div>

                        <label for="aadhaarVisible">Aadhaar Number <span class="required">*</span></label>
                        <input id="aadhaarVisible" name="aadhaarVisible" placeholder="Enter 12-digit Aadhaar"
                            inputmode="numeric" required />
                        <input id="aadhaarFull" type="hidden" />

                        <label for="resAddress">Residential Address <span class="required">*</span></label>
                        <textarea id="resAddress" name="resAddress" rows="2" required></textarea>

                        <div class="row">
                            <div><label for="resCity">City <span class="required">*</span></label><input id="resCity"
                                    name="resCity" required /></div>
                            <div><label for="resPincode">Pin Code <span class="required">*</span></label><input
                                    id="resPincode" name="resPincode" pattern="[0-9]{6}" required /></div>
                        </div>

                        <div class="row">
                            <div>
                                <label>Passport Photo <span class="required">*</span></label>
                                <label class="file-box"><input type="file" id="photoFile" accept="image/*"
                                        required><span>Click to upload</span>
                                    <div class="file-name" id="photoName"></div>
                                    <div class="file-error" id="photoError"></div>
                                </label>
                            </div>
                            <div>
                                <label>Signature (scanned) <span class="required">*</span></label>
                                <label class="file-box"><input type="file" id="signFile" accept="image/*"
                                        required><span>Click to upload</span>
                                    <div class="file-name" id="signName"></div>
                                    <div class="file-error" id="signError"></div>
                                </label>
                            </div>
                        </div>
                    </fieldset>
                </div>

                <!-- STEP 2: BUSINESS -->
                <div class="step" data-step="1" style="display:none">
                    <fieldset>
                        <legend>2. Business Details</legend>
                        <label for="businessName">Business / Company Name <span class="required">*</span></label>
                        <input id="businessName" name="businessName" required />

                        <label for="businessType">Type of Business <span class="required">*</span></label>
                        <select id="businessType" name="businessType" required>
                            <option value="">-- Select --</option>
                            <option>Proprietorship</option>
                            <option>Partnership</option>
                            <option>Private Limited</option>
                            <option>Public Limited</option>
                            <option>LLP</option>
                        </select>

                        <div class="row">
                            <div><label for="registrationNumber">Business Registration / CIN</label><input
                                    id="registrationNumber" /></div>
                            <div><label for="natureOfBusiness">Nature of Business</label><input id="natureOfBusiness"
                                    placeholder="e.g. Trading / Manufacturing" /></div>
                        </div>

                        <div class="row">
                            <div><label for="gstNumber">GST Number</label><input id="gstNumber"
                                    pattern="[0-9]{2}[A-Z]{5}[0-9]{4}[A-Z]{1}[1-9A-Z]{1}Z[0-9A-Z]{1}" /></div>
                            <div><label for="panCompany">Company PAN</label><input id="panCompany"
                                    pattern="[A-Z]{5}[0-9]{4}[A-Z]{1}" /></div>
                        </div>
                    </fieldset>
                </div>

                <!-- STEP 3: ADDRESS & CONTACT -->
                <div class="step" data-step="2" style="display:none">
                    <fieldset>
                        <legend>3. Registered Address & Contact</legend>
                        <label for="address">Registered Address <span class="required">*</span></label>
                        <textarea id="address" rows="2" required></textarea>

                        <div class="row">
                            <div>
                                <label for="state">State <span class="required">*</span></label>
                                <select id="state" required>
                                    <option value="">-- Select State --</option>
                                    <option>Maharashtra</option>
                                    <option>Karnataka</option>
                                    <option>Tamil Nadu</option>
                                    <option>Uttar Pradesh</option>
                                    <option>West Bengal</option>
                                    <option>Gujarat</option>
                                    <option>Madhya Pradesh</option>
                                    <option>Rajasthan</option>
                                    <option>Bihar</option>
                                </select>
                            </div>
                            <div>
                                <label for="district">District <span class="required">*</span></label>
                                <select id="district" required>
                                    <option value="">-- Select District --</option>
                                </select>
                            </div>
                        </div>

                        <div class="row">
                            <div><label for="city">City <span class="required">*</span></label><input id="city"
                                    required></div>
                            <div><label for="pincode">Pin Code <span class="required">*</span></label><input
                                    id="pincode" pattern="[0-9]{6}" required></div>
                        </div>

                        <div class="row">
                            <div><label for="contactPhone">Primary Contact Mobile <span
                                        class="required">*</span></label><input id="contactPhone"
                                    pattern="[6-9]{1}[0-9]{9}" required></div>
                            <div><label for="contactEmail">Primary Email <span class="required">*</span></label><input
                                    id="contactEmail" type="email" required></div>
                        </div>

                        <label for="website">Website / LinkedIn (optional)</label>
                        <input id="website" />
                    </fieldset>
                </div>

                <!-- STEP 4: DOCUMENTS -->
                <div class="step" data-step="3" style="display:none">
                    <fieldset>
                        <legend>4. Documents Upload</legend>
                        <label>Business Registration Certificate <span class="required">*</span></label>
                        <label class="file-box"><input type="file" id="businessRegFile" accept=".pdf,image/*"
                                required><span>Upload Business Reg. Cert.</span>
                            <div class="file-name" id="businessRegName"></div>
                            <div class="file-error" id="businessRegError"></div>
                        </label>

                        <div class="row">
                            <div><label>GST Certificate (optional)</label><label class="file-box"><input type="file"
                                        id="gstCertFile" accept=".pdf,image/*"><span>Upload GST Cert.</span>
                                    <div class="file-name" id="gstCertName"></div>
                                </label></div>
                            <div><label>Company PAN (optional)</label><label class="file-box"><input type="file"
                                        id="panCompanyFile" accept=".pdf,image/*"><span>Upload Company PAN</span>
                                    <div class="file-name" id="panCompanyFileName"></div>
                                </label></div>
                        </div>

                        <label>Address Proof <span class="required">*</span></label>
                        <label class="file-box"><input type="file" id="addressProofFile" accept=".pdf,image/*"
                                required><span>Upload Address Proof</span>
                            <div class="file-name" id="addressProofFileName"></div>
                            <div class="file-error" id="addressProofFileError"></div>
                        </label>
                    </fieldset>

                    <fieldset>
                        <legend>Authorized Signatory (Basic KYC)</legend>
                        <label for="authName">Name <span class="required">*</span></label><input id="authName" required>
                        <label for="authDesignation">Designation <span class="required">*</span></label><input
                            id="authDesignation" required>
                        <label for="authMobile">Mobile <span class="required">*</span></label><input id="authMobile"
                            pattern="[6-9]{1}[0-9]{9}" required>
                        <label for="authEmail">Email <span class="required">*</span></label><input id="authEmail"
                            type="email" required>

                        <label>Authorized Person ID Proof <span class="required">*</span></label>
                        <label class="file-box"><input type="file" id="authIdFile" accept=".pdf,image/*"
                                required><span>Upload ID Proof</span>
                            <div class="file-name" id="authIdName"></div>
                            <div class="file-error" id="authIdError"></div>
                        </label>
                    </fieldset>
                </div>

                <!-- STEP 5: REVIEW & SUBMIT -->
                <div class="step" data-step="4" style="display:none">
                    <fieldset>
                        <legend>5. Review & Submit</legend>
                        <div class="review-box" id="reviewBox"></div>
                        <div class="muted" style="margin-top:10px">On submit a reference will be generated and saved.
                            You will be redirected to <code>currentsub.html</code>.</div>
                    </fieldset>
                </div>

            </div>

            <div class="controls">
                <button type="button" class="btn secondary" id="prevBtn" disabled>‚Üê Previous</button>
                <div style="display:flex;gap:8px">
                    <button type="button" class="btn secondary" id="saveDraftBtn">Save Draft</button>
                    <button type="button" class="btn" id="nextBtn">Next ‚Üí</button>
                    <button type="submit" class="btn" id="submitBtn" style="display:none">Submit Application</button>
                </div>
            </div>
        </form>

        <div class="muted" style="margin-top:12px">All fields marked <span class="required">*</span> are mandatory for
            their step.</div>
    </div>

    <div id="toast" class="toast"></div>
    <script>
        // ‚úÖ COMPLETE UPDATED SCRIPT - MongoDB Backend + Wizard Form
        // Tumhara original code + MongoDB integration üöÄ

        const { jsPDF } = window.jspdf || {};
        const STEPS = 5;
        let currentStep = 0;
        const MAX_FILE_BYTES = 2.5 * 1024 * 1024;
        const ABS_MAX = 10 * 1024 * 1024;

        const tabsEl = document.getElementById('tabs');
        const form = document.getElementById('wizardForm');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const submitBtn = document.getElementById('submitBtn');
        const saveDraftBtn = document.getElementById('saveDraftBtn');
        const toast = document.getElementById('toast');
        const reviewBox = document.getElementById('reviewBox');

        // ‚úÖ Create tabs (same)
        const TAB_LABELS = ['Personal', 'Business', 'Address & Contact', 'Documents', 'Review & Submit'];
        for (let i = 0; i < STEPS; i++) {
            const t = document.createElement('div');
            t.className = 'tab' + (i === 0 ? ' active' : '');
            t.textContent = TAB_LABELS[i];
            t.dataset.i = i;
            t.addEventListener('click', () => {
                if (parseInt(t.dataset.i) <= currentStep) goToStep(parseInt(t.dataset.i));
            });
            tabsEl.appendChild(t);
        }

        // ‚úÖ Helpers
        function q(id) { return document.getElementById(id); }
        function showToast(msg, time = 1600) {
            toast.style.display = 'block';
            toast.textContent = msg;
            setTimeout(() => toast.style.display = 'none', time);
        }
        function normalizeDigits(s) { return (s || '').toString().replace(/\D/g, ''); }

        // ‚úÖ State-District Mapping (same - working perfectly)
        const stateDistrictMap = {
            "Maharashtra": ["Mumbai Suburban", "Pune", "Satara", "Kolhapur", "Nashik"],
            "Karnataka": ["Bengaluru Urban", "Mysuru", "Mangaluru"],
            "Tamil Nadu": ["Chennai", "Coimbatore", "Madurai"],
            "Uttar Pradesh": ["Lucknow", "Kanpur", "Ghaziabad"],
            "West Bengal": ["Kolkata", "Howrah"],
            "Gujarat": ["Ahmedabad", "Surat"],
            "Madhya Pradesh": ["Bhopal", "Indore"],
            "Rajasthan": ["Jaipur", "Jodhpur"],
            "Bihar": ["Patna", "Gaya"]
        };

        // ‚úÖ State-District Logic (DOM ready pehle chalao)
        document.addEventListener('DOMContentLoaded', function () {
            const stateSelect = q('state');
            const districtSelect = q('district');
            const cityInput = q('city');

            stateSelect?.addEventListener('change', function () {
                districtSelect.innerHTML = '<option value="">-- Select District --</option>';
                if (this.value && stateDistrictMap[this.value]) {
                    stateDistrictMap[this.value].forEach(district => {
                        const option = document.createElement('option');
                        option.value = district;
                        option.textContent = district;
                        districtSelect.appendChild(option);
                    });
                }
            });

            districtSelect?.addEventListener('change', function () {
                if (this.value) {
                    cityInput.value = this.value;
                }
            });
        });

        // ‚úÖ Aadhaar Masking (same)
        const aadVisible = q('aadhaarVisible'), aadFull = q('aadhaarFull');
        if (aadVisible && aadFull) {
            function maskAadhaar(full) {
                if (!full) return '';
                const d = normalizeDigits(full);
                if (d.length < 12) return full;
                return 'XXXX XXXX ' + d.slice(-4);
            }
            aadVisible.addEventListener('input', e => { aadFull.value = normalizeDigits(e.target.value); });
            aadVisible.addEventListener('blur', () => {
                const f = normalizeDigits(aadFull.value);
                if (f.length === 12) aadVisible.value = maskAadhaar(f);
            });
            aadVisible.addEventListener('focus', () => {
                const full = normalizeDigits(aadFull.value);
                aadVisible.value = full || '';
            });
        }

        // ‚úÖ File Handling (same - but files optional for JSON)
        function bindFileInput(fileId, nameId, errId) {
            const input = q(fileId), nameEl = q(nameId), errEl = errId ? q(errId) : null;
            if (!input) return;
            input.addEventListener('change', () => {
                nameEl.textContent = '';
                if (errEl) errEl.textContent = '';
                const f = input.files[0];
                if (!f) return;
                nameEl.textContent = f.name + ' (' + Math.round(f.size / 1024) + ' KB)';
                if (f.size > ABS_MAX) {
                    if (errEl) errEl.textContent = 'File too large. Max 10 MB.';
                    input.value = '';
                    nameEl.textContent = '';
                }
            });
        }
        bindFileInput('photoFile', 'photoName', 'photoError');
        bindFileInput('signFile', 'signName', 'signError');
        bindFileInput('businessRegFile', 'businessRegName', 'businessRegError');
        bindFileInput('gstCertFile', 'gstCertName');
        bindFileInput('panCompanyFile', 'panCompanyFileName');
        bindFileInput('addressProofFile', 'addressProofFileName', 'addressProofFileError');
        bindFileInput('authIdFile', 'authIdName', 'authIdError');

        // ‚úÖ Wizard Step Logic (same)
        function goToStep(i) {
            currentStep = i;
            document.querySelectorAll('.step').forEach(s => s.style.display = (parseInt(s.dataset.step) === i ? '' : 'none'));
            document.querySelectorAll('.tab').forEach((t, idx) => {
                t.classList.toggle('active', idx === i);
                t.classList.toggle('completed', idx < i);
            });
            prevBtn.disabled = (i === 0);
            nextBtn.style.display = (i < STEPS - 1 ? '' : 'none');
            submitBtn.style.display = (i === STEPS - 1 ? '' : 'none');
            if (i === STEPS - 1) populateReview();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function validateStep(i) {
            const step = document.querySelector(`.step[data-step="${i}"]`);
            if (!step) return { ok: true };
            const inputs = Array.from(step.querySelectorAll('input,select,textarea')).filter(el => el.offsetParent !== null);
            for (const el of inputs) {
                if (el.required && !el.value.trim()) {
                    el.focus();
                    return { ok: false, msg: 'Please fill all required fields in this step.' };
                }
            }
            return { ok: true };
        }

        nextBtn.addEventListener('click', () => {
            const v = validateStep(currentStep);
            if (!v.ok) { showToast(v.msg); return; }
            goToStep(Math.min(STEPS - 1, currentStep + 1));
        });

        prevBtn.addEventListener('click', () => goToStep(Math.max(0, currentStep - 1)));

        // ‚úÖ Review Population
        function populateReview() {
            const data = collectFormData();
            reviewBox.innerHTML = `
        <div class="review-section">
            <h5>üë§ Personal</h5>
            <p><strong>Name:</strong> ${data.fullName || 'N/A'}</p>
            <p><strong>PAN:</strong> ${data.personalPan || 'N/A'}</p>
        </div>
        <div class="review-section">
            <h5>üè¢ Business</h5>
            <p><strong>Name:</strong> ${data.businessName || 'N/A'}</p>
            <p><strong>Type:</strong> ${data.businessType || 'N/A'}</p>
        </div>
        <div class="review-section">
            <h5>üìç Address</h5>
            <p><strong>City:</strong> ${data.city || 'N/A'}, ${data.state || 'N/A'}</p>
        </div>
        <div class="review-section">
            <h5>üìû Contact</h5>
            <p><strong>Phone:</strong> ${data.contactPhone || 'N/A'}</p>
            <p><strong>Email:</strong> ${data.contactEmail || 'N/A'}</p>
        </div>
    `;
        }

        // üî• üî• üî• MAIN SUBMIT FUNCTION - MongoDB Backend Integration üî• üî• üî•
        form.addEventListener('submit', async (e) => {
            e.preventDefault();

            // ‚úÖ 1. AGE VALIDATION (18+ only)
            const dob = q('dob')?.value;
            if (dob) {
                const dobDate = new Date(dob);
                const today = new Date();
                let age = today.getFullYear() - dobDate.getFullYear();
                const monthDiff = today.getMonth() - dobDate.getMonth();
                if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < dobDate.getDate())) age--;
                if (age < 18) {
                    showToast('‚ùå Applicant must be 18+ years old');
                    q('dob').focus();
                    return;
                }
            }

            // ‚úÖ 2. REQUIRED FIELDS CHECK
            const requiredFields = [
                'fullName', 'fatherName', 'dob', 'personalPan',
                'businessName', 'businessType', 'address', 'state',
                'district', 'city', 'pincode', 'contactPhone', 'contactEmail',
                'authName', 'authDesignation', 'authMobile', 'authEmail'
            ];

            for (let field of requiredFields) {
                if (!q(field)?.value.trim()) {
                    showToast(`‚ö†Ô∏è Please fill ${field.replace(/([A-Z])/g, ' $1').toLowerCase()}`);
                    q(field)?.scrollIntoView({ behavior: 'smooth' });
                    q(field)?.focus();
                    return;
                }
            }

            // ‚úÖ 3. FORMAT VALIDATIONS
            if (!/^[A-Z]{5}[0-9]{4}[A-Z]{1}$/i.test(q('personalPan').value)) {
                showToast('‚ùå Invalid PAN format');
                q('personalPan').focus();
                return;
            }
            if (!/^\d{10}$/.test(normalizeDigits(q('contactPhone').value))) {
                showToast('‚ùå Phone must be 10 digits');
                q('contactPhone').focus();
                return;
            }
            if (!/^\d{6}$/.test(q('pincode').value)) {
                showToast('‚ùå PIN code must be 6 digits');
                q('pincode').focus();
                return;
            }

            // ‚úÖ 4. SHOW LOADING
            submitBtn.disabled = true;
            submitBtn.textContent = '‚è≥ Submitting...';

            try {
                // ‚úÖ 5. COLLECT FORM DATA (Exact backend format)
                const formData = {
                    accountType: q('accountType')?.value || 'Current',
                    fullName: q('fullName').value,
                    fatherName: q('fatherName').value,
                    dob: q('dob').value,
                    personalPan: q('personalPan').value.toUpperCase(),
                    aadhaarFull: normalizeDigits(q('aadhaarFull')?.value || ''),
                    businessName: q('businessName').value,
                    businessType: q('businessType').value,
                    registrationNumber: q('registrationNumber')?.value || '',
                    natureOfBusiness: q('natureOfBusiness')?.value || '',
                    gstNumber: q('gstNumber')?.value || '',
                    panCompany: q('panCompany')?.value || '',
                    address: q('address').value,
                    state: q('state').value,
                    district: q('district').value,
                    city: q('city').value,
                    pincode: q('pincode').value,
                    contactPhone: normalizeDigits(q('contactPhone').value),
                    contactEmail: q('contactEmail').value,
                    website: q('website')?.value || '',
                    authName: q('authName').value,
                    authDesignation: q('authDesignation').value,
                    authMobile: normalizeDigits(q('authMobile').value),
                    authEmail: q('authEmail').value
                };

                // ‚úÖ 6. SEND TO MONGODB BACKEND
                const response = await fetch('http://localhost:5000/api/accounts/open', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });

                const result = await response.json();

                if (response.ok && result.success) {
                    // ‚úÖ 7. SUCCESS - Save Reference & Redirect
                    localStorage.setItem("latestCurrentRef", result.refNo);
                    showToast(`üéâ Success! Reference: ${result.refNo}`);

                    setTimeout(() => {
                        window.location.href = formData.accountType === 'Savings' ?
                            "savingsub.html" : "currentsub.html";
                    }, 1500);
                } else {
                    showToast(`‚ùå Error: ${result.error || 'Submission failed'}`);
                }

            } catch (error) {
                console.error('‚ùå Network Error:', error);
                showToast('‚ùå Server Error! Is backend running on localhost:5000?');
            } finally {
                // ‚úÖ 8. RESET BUTTON
                submitBtn.disabled = false;
                submitBtn.textContent = 'Submit Application';
            }
        });

        // ‚úÖ Initialize first step
        goToStep(0);
    </script>


</body>

</html>