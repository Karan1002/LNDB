<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Current Account Application Submitted</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f4f8fb;
            color: #004a8f;
            max-width: 820px;
            margin: 28px auto;
            padding: 22px;
        }

        h1 {
            text-align: center;
            color: #003380;
            margin-bottom: 6px;
        }

        .ref-box {
            text-align: center;
            background-color: white;
            border-radius: 8px;
            padding: 12px 16px;
            margin: 12px auto 18px;
            box-shadow: 0 2px 10px rgba(0, 74, 143, 0.08);
            font-weight: 700;
            color: #0d6efd;
            font-size: 1.15rem;
            width: fit-content;
        }

        p {
            text-align: center;
            font-size: 1rem;
            margin-bottom: 14px;
            color: #233;
        }

        ul {
            background: white;
            padding: 16px 18px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 74, 143, 0.06);
            margin-bottom: 18px;
        }

        ul li {
            margin: 8px 0;
            font-size: 0.98rem;
            color: #333;
        }

        .controls {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin-top: 18px;
        }

        button,
        .btn {
            padding: 10px 18px;
            font-size: 15px;
            background-color: #0d6efd;
            color: #fff;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }

        button.secondary {
            background: #6c757d;
        }

        .footer {
            text-align: center;
            font-size: 0.9rem;
            margin-top: 22px;
            color: #555;
        }

        .small {
            font-size: 0.9rem;
            color: #666;
            text-align: center;
            margin-top: 10px;
        }
    </style>
    <!-- jsPDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>

<body>
    <h1>Your Current Account Application Has Been Submitted!</h1>

    <div class="ref-box">
        Reference No: <span id="refNo">CA000000</span>
    </div>

    <p>Thank you for choosing LNDB for your business banking. Please take the printed PDF and the original documents to
        your nearest branch.</p>

    <ul>
        <li>Business Registration Certificate</li>
        <li>PAN Card of Proprietor / Firm</li>
        <li>Address Proof of Business</li>
        <li>GST Certificate (if applicable)</li>
        <li>Photograph & Signature of Authorized Signatory</li>
    </ul>

    <div class="controls">
        <button id="downloadPDF">Download Application PDF</button>
        <button class="secondary" id="returnHome">Return to Home</button>
    </div>

    <div class="small">PDF will include full application details, uploaded images (if small enough), signature boxes and
        a branch-use page.</div>

    <div class="footer">© 2025 Lena Dena Bank (LNDB) — All Rights Reserved.</div>

    <script>
        (function () {
            const refEl = document.getElementById('refNo');
            const savedRef = localStorage.getItem("latestCurrentRef");

            refEl.textContent = savedRef || "Unavailable";

            function getRecordByRef(ref) {
                try {
                    const list = JSON.parse(localStorage.getItem("lndbCurrentAccounts") || "[]");
                    if (!list.length) return null;
                    return list.find(r => r.refNo === ref) || list[list.length - 1];
                } catch {
                    return null;
                }
            }

            async function buildAndDownloadPDF() {
                const ref = savedRef || ("CA" + Date.now());
                const record = getRecordByRef(ref) || {};
                const { jsPDF } = window.jspdf;

                const doc = new jsPDF({ unit: "pt", format: "a4" });
                const pageH = doc.internal.pageSize.getHeight();
                const pageW = doc.internal.pageSize.getWidth();
                const M = 40;
                let y = 80;

                const ap = record.personal || {};
                const bd = record.businessData || {};
                const ct = record.contact || {};
                const ad = record.address || {};
                const imgs = record.documents || {};

                const blue = () => doc.setTextColor(29, 78, 156);

                const row = (label, value) => {
                    doc.setFontSize(9); doc.setTextColor(0);
                    doc.text(label, M, y);
                    doc.text(String(value || ""), M + 160, y);
                    y += 12;
                };

                async function addImg(obj, x, yy, w, h, text) {
                    if (!obj?.base64) return;
                    const type = obj.base64.includes("png") ? "PNG" : "JPEG";
                    doc.addImage(obj.base64, type, x, yy, w, h);
                    doc.setFontSize(8);
                    doc.text(text, x, yy + h + 12);
                }

                // Header
                doc.setFillColor(20, 72, 140);
                doc.rect(0, 0, pageW, 60, "F");
                doc.setFontSize(15);
                doc.setTextColor("#fff");
                doc.text("LENA DENA BANK (LNDB)", M, 36);
                doc.setFontSize(10);
                doc.text("Current Account Application Form", pageW - 250, 36);

                // Personal
                y = 90;
                blue(); doc.setFontSize(11); doc.text("APPLICANT DETAILS", M, y); y += 16;
                row("Full Name:", ap.fullName);
                row("Father / Spouse Name:", ap.fatherName);
                row("DOB:", ap.dob);
                row("PAN:", ap.pan);
                row("Aadhaar:", ap.aadhaar ? "XXXX XXXX " + ap.aadhaar.slice(-4) : "");

                // Business section
                y += 12;
                blue(); doc.text("BUSINESS DETAILS", M, y); y += 16;
                row("Business Name:", bd.businessName);
                row("Type:", bd.businessType);
                row("GST No:", bd.gstNumber);

                // Contact
                y += 12;
                blue(); doc.text("CONTACT DETAILS", M, y); y += 16;
                row("Phone:", ct.phone);
                row("Email:", ct.email);

                // Address
                y += 12;
                blue(); doc.text("REGISTERED ADDRESS", M, y); y += 16;
                row("Address:", ad.addressLine);
                row("City / Pincode:", `${ad.city || ""} / ${ad.pincode || ""}`);

                // Branch Use
                y += 16;
                blue(); doc.text("FOR BRANCH USE ONLY", M, y); y += 18;
                row("Account Number:", "________________");
                row("Employee Code:", "________________");

                y += 30;
                doc.text("Branch Seal & Date: _________________________", M, y);
                y += 40;

                // Declaration
                blue(); doc.text("DECLARATION", M, y); y += 16;
                doc.setFontSize(8); doc.setTextColor(0);
                doc.text("• I/We declare that the above information is correct.", M, y); y += 12;
                doc.text("• I/We agree to LNDB account operation terms.", M, y); y += 12;
                doc.text("• Original documents will be shown at branch.", M, y); y += 28;

                // --- MOVE PHOTO & SIGNATURE DOWN HERE ---
                await addImg(imgs.photo, M, y, 90, 105, "Applicant Photo");
                await addImg(imgs.signature, M + 130, y + 30, 120, 45, "Signature");

                y += 160;
                doc.setFontSize(8);
                doc.text("System Generated Form — No Signature Required", M, pageH - 20);

                doc.save("LNDB_Current_Account_" + ref + ".pdf");
            }

            document.getElementById("downloadPDF").addEventListener("click", async function () {
                this.disabled = true;
                this.textContent = "Preparing PDF...";
                await buildAndDownloadPDF();
                this.disabled = false;
                this.textContent = "Download Application PDF";
            });
        })();
    </script>


</body>

</html>